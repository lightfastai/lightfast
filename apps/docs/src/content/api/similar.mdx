---
title: POST /v1/similar
description: Find related content based on semantic similarity
---

# POST /v1/similar

Discover content semantically related to a specific document. Perfect for "more like this" features, exploring related topics, or finding connected discussions.

## Endpoint

```
POST https://api.lightfast.ai/v1/similar
```

## Authentication

```bash
Authorization: Bearer lf_sk_live_...
```

## Request Body

```typescript
{
  id: string                 // Source content ID to find similar items for
  limit?: number             // Results to return (default: 10, max: 100)
  offset?: number            // Pagination offset (default: 0)
  includeRationale?: boolean // Include similarity explanation (default: false)
  filters?: {
    type?: string[]          // Filter by content type
    source?: string          // Filter by source system
    createdAfter?: string    // ISO 8601 date
    createdBefore?: string   // ISO 8601 date
    excludeIds?: string[]    // IDs to exclude from results
    [key: string]: any       // Custom metadata filters
  }
}
```

## Response

```typescript
{
  data: Array<{
    id: string               // Content identifier
    title: string            // Content title
    snippet: string          // Brief preview
    score: number            // Similarity score (0-1)
    url?: string             // Link to original
    type: string             // Content type
    source: string           // Source system
    createdAt: string        // ISO 8601 timestamp
    updatedAt: string        // ISO 8601 timestamp
    owner?: string           // Content owner
    metadata: Record<string, any>
    rationale?: string       // Why this is similar
  }>
  meta: {
    sourceId: string         // Original content ID
    total: number            // Total similar results
    limit: number
    offset: number
    took: number             // Query time in ms
  }
  requestId: string
}
```

## Example Request


    ```bash
    curl -X POST https://api.lightfast.ai/v1/similar \
      -H "Authorization: Bearer $LIGHTFAST_API_KEY" \
      -H "Content-Type: application/json" \
      -d '{
        "id": "pr-123",
        "limit": 10,
        "includeRationale": true,
        "filters": {
          "type": ["pull_request", "issue"]
        }
      }'
    ```
  

## Example Response

```json
{
  "data": [
    {
      "id": "pr-456",
      "title": "Add JWT refresh token rotation",
      "snippet": "Implements automatic refresh token rotation for improved security...",
      "score": 0.89,
      "url": "https://github.com/org/repo/pull/456",
      "type": "pull_request",
      "source": "github",
      "createdAt": "2024-04-10T09:20:00Z",
      "updatedAt": "2024-04-11T16:30:00Z",
      "owner": "bob",
      "metadata": {
        "repository": "org/repo",
        "state": "merged",
        "labels": ["security", "authentication"]
      },
      "rationale": "Similar authentication concepts. Both implement OAuth 2.0 security features. Same repository and labels."
    },
    {
      "id": "issue-789",
      "title": "Security review: Authentication tokens",
      "snippet": "We need to review token expiration and refresh mechanisms...",
      "score": 0.84,
      "url": "https://github.com/org/repo/issues/789",
      "type": "issue",
      "source": "github",
      "createdAt": "2024-03-01T14:15:00Z",
      "updatedAt": "2024-03-15T11:00:00Z",
      "owner": "alice",
      "metadata": {
        "repository": "org/repo",
        "state": "closed",
        "labels": ["security"]
      },
      "rationale": "Discusses same authentication topics. Referenced by original PR."
    }
  ],
  "meta": {
    "sourceId": "pr-123",
    "total": 27,
    "limit": 10,
    "offset": 0,
    "took": 89
  },
  "requestId": "req_abc123def456"
}
```

## Use Cases

### "More Like This" Feature

Show related content to users:

```typescript
// User viewing a document
const currentDoc = 'pr-123'

// Find similar
const similar = await lf.similar({
  id: currentDoc,
  limit: 5
})

// Display recommendations
console.log('Related PRs:')
similar.data.forEach(item => {
  console.log(`- ${item.title}`)
})
```

### Discover Related Discussions

Find conversations about similar topics:

```typescript
const related = await lf.similar({
  id: 'issue-456',
  filters: {
    type: ['discussion', 'issue', 'pull_request']
  },
  limit: 10
})
```

### Find Duplicate Issues

Detect potential duplicates before creating new issues:

```typescript
// Before creating issue, check for similar
const possibleDuplicates = await lf.similar({
  id: 'issue-draft',  // Draft issue content
  filters: {
    type: ['issue'],
    state: 'open'
  },
  limit: 5
})

if (possibleDuplicates.data.some(d => d.score > 0.95)) {
  console.warn('Very similar issue already exists!')
}
```

### Content Clustering

Group related content for organization:

```typescript
async function findClusters(ids: string[]) {
  const clusters: Map<string, string[]> = new Map()

  for (const id of ids) {
    const similar = await lf.similar({ id, limit: 20 })

    // Group highly similar items (score > 0.8)
    const cluster = similar.data
      .filter(s => s.score > 0.8)
      .map(s => s.id)

    clusters.set(id, cluster)
  }

  return clusters
}
```

### Knowledge Graph Exploration

Navigate related content interactively:

```typescript
async function exploreGraph(startId: string, depth = 3) {
  const visited = new Set<string>()
  const graph: Record<string, any[]> = {}

  async function explore(id: string, currentDepth: number) {
    if (visited.has(id) || currentDepth > depth) return
    visited.add(id)

    const similar = await lf.similar({
      id,
      limit: 5,
      filters: { excludeIds: Array.from(visited) }
    })

    graph[id] = similar.data

    for (const item of similar.data.slice(0, 2)) {
      await explore(item.id, currentDepth + 1)
    }
  }

  await explore(startId, 0)
  return graph
}
```

## Similarity Scoring

### Score Interpretation

- **0.90-1.00**: Nearly identical or duplicate content
- **0.75-0.89**: Highly related, same topic/concept
- **0.60-0.74**: Moderately related, overlapping themes
- **0.40-0.59**: Loosely related, some common elements
- **0.00-0.39**: Weakly related or unrelated

### What Makes Content Similar?

Similarity is based on:
1. **Semantic meaning**: Content discussing same concepts
2. **Topic overlap**: Shared subjects and themes
3. **Entity connections**: Common people, repos, projects
4. **Graph relationships**: Direct or indirect references
5. **Metadata similarity**: Same labels, types, sources

## Filtering

### Exclude Source Document

The source document is automatically excluded. To exclude additional IDs:

```typescript
const similar = await lf.similar({
  id: 'pr-123',
  filters: {
    excludeIds: ['pr-124', 'pr-125']  // Don't show these
  }
})
```

### Filter by Type

Focus on specific content types:

```typescript
// Only similar PRs
const similarPRs = await lf.similar({
  id: 'pr-123',
  filters: { type: ['pull_request'] }
})

// PRs and issues
const code = await lf.similar({
  id: 'pr-123',
  filters: { type: ['pull_request', 'issue'] }
})
```

### Filter by Date

Find recent similar content:

```typescript
const recentSimilar = await lf.similar({
  id: 'issue-456',
  filters: {
    createdAfter: '2024-01-01'
  }
})
```

### Custom Filters

Apply any metadata filter:

```typescript
const similar = await lf.similar({
  id: 'pr-123',
  filters: {
    repository: 'org/api-service',
    state: 'merged',
    labels: ['security']
  }
})
```

## Pagination

Paginate through similar results:

```typescript
// First page
const page1 = await lf.similar({
  id: 'pr-123',
  limit: 20,
  offset: 0
})

// Second page
const page2 = await lf.similar({
  id: 'pr-123',
  limit: 20,
  offset: 20
})
```

## Rationale

Enable `includeRationale` to understand why items are similar:

```typescript
const similar = await lf.similar({
  id: 'pr-123',
  includeRationale: true
})

similar.data.forEach(item => {
  console.log(`${item.title}`)
  console.log(`Score: ${item.score}`)
  console.log(`Why: ${item.rationale}`)
  console.log('---')
})
```

Example rationale:
```
"Similar authentication concepts. Both implement OAuth 2.0 security features.
Same repository and labels. Referenced in same design doc."
```

## Combining with Search

Use similar after search for discovery:

```typescript
// 1. Search for initial results
const results = await lf.search({
  query: 'authentication implementation'
})

// 2. Find similar to most relevant result
const similar = await lf.similar({
  id: results.data[0].id,
  limit: 5
})

// 3. Combine for broader context
const allResults = [...results.data, ...similar.data]
```

## Performance Tips

### Use Appropriate Limits

Request only what you'll display:

```typescript
// ✅ Good: Small limit for UI
const similar = await lf.similar({ id, limit: 5 })

// ❌ Wasteful: Large limit when showing 5
const similar = await lf.similar({ id, limit: 100 })
```

### Apply Filters Early

Filter on server, not client:

```typescript
// ✅ Good: Filter in request
const similar = await lf.similar({
  id,
  filters: { type: ['pull_request'] }
})

// ❌ Bad: Filter after fetching
const all = await lf.similar({ id })
const filtered = all.data.filter(d => d.type === 'pull_request')
```

### Cache Similar Results

Cache similarity results for frequently accessed content:

```typescript
const similarCache = new Map<string, any>()

async function getSimilar(id: string) {
  if (similarCache.has(id)) {
    return similarCache.get(id)
  }

  const similar = await lf.similar({ id })
  similarCache.set(id, similar)

  // Expire cache after 1 hour
  setTimeout(() => similarCache.delete(id), 3600000)

  return similar
}
```

## Error Handling

```typescript
try {
  const similar = await lf.similar({ id: 'pr-123' })
} catch (error) {
  if (error.code === 'resource_not_found') {
    console.error('Source document not found')
  } else if (error.code === 'invalid_request') {
    console.error('Invalid request:', error.message)
  }
}
```

## Next Steps

- **[POST /v1/search](/api/search)** - Search to find initial content
- **[POST /v1/contents](/api/contents)** - Get full content for similar items
- **[POST /v1/answer](/api/answer)** - Get synthesized answers about related content
- **[Discovery Patterns Guide](/docs/guides/discovery-patterns)** - Explore content effectively
