---
title: Deployment
description: Deploy agents to production environments
---

# Deployment Guide

Learn how to deploy Lightfast agents to production with confidence, covering everything from local development to global scale.

## Deployment Options

### Lightfast Cloud (Recommended)

The easiest way to deploy agents:

```bash
# Install CLI
npm install -g @lightfast/cli

# Initialize project
lightfast init my-agent

# Deploy to cloud
lightfast deploy --production
```

### Self-Hosted

Run Lightfast in your infrastructure:

```bash
# Using Docker
docker run -d \
  --name lightfast \
  -p 8080:8080 \
  -e LIGHTFAST_LICENSE_KEY=your-key \
  lightfast/engine:latest

# Using Kubernetes
kubectl apply -f lightfast-deployment.yaml
```

### Hybrid Deployment

Mix cloud and on-premise:

```typescript
const agent = new Agent({
  deployment: {
    mode: 'hybrid',
    cloud: ['llm-inference', 'web-tools'],
    onPremise: ['database', 'internal-apis']
  }
});
```

## Environment Configuration

### Development

```yaml
# .env.development
LIGHTFAST_API_KEY=lf_dev_...
LIGHTFAST_LOG_LEVEL=debug
LIGHTFAST_TIMEOUT=60000
LIGHTFAST_RETRY_ATTEMPTS=3
```

### Staging

```yaml
# .env.staging
LIGHTFAST_API_KEY=lf_stg_...
LIGHTFAST_LOG_LEVEL=info
LIGHTFAST_TIMEOUT=30000
LIGHTFAST_MONITORING=true
```

### Production

```yaml
# .env.production
LIGHTFAST_API_KEY=lf_prod_...
LIGHTFAST_LOG_LEVEL=warn
LIGHTFAST_TIMEOUT=15000
LIGHTFAST_MONITORING=true
LIGHTFAST_ALERTS=true
```

## CI/CD Pipeline

### GitHub Actions

```yaml
name: Deploy Agent

on:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: npm ci
      - run: npm test

  deploy:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: lightfast/deploy-action@v1
        with:
          api-key: ${{ secrets.LIGHTFAST_API_KEY }}
          environment: production
```

## Infrastructure as Code

### Terraform Configuration

```hcl
resource "lightfast_agent" "main" {
  name        = "production-agent"
  model       = "gpt-4"
  
  scaling {
    min_instances = 2
    max_instances = 10
    target_cpu    = 70
  }
  
  monitoring {
    enabled = true
    alerts  = true
  }
}

resource "lightfast_tool" "database" {
  agent_id = lightfast_agent.main.id
  name     = "database-query"
  
  config {
    connection_string = var.database_url
    max_connections   = 20
  }
}
```

## Scaling Configuration

### Horizontal Scaling

```typescript
const scalingConfig = {
  autoscaling: {
    enabled: true,
    minReplicas: 2,
    maxReplicas: 100,
    metrics: [
      {
        type: 'cpu',
        targetUtilization: 70
      },
      {
        type: 'memory',
        targetUtilization: 80
      },
      {
        type: 'requests',
        targetPerSecond: 100
      }
    ]
  }
};
```

### Vertical Scaling

```typescript
const resourceConfig = {
  resources: {
    requests: {
      cpu: '500m',
      memory: '1Gi'
    },
    limits: {
      cpu: '2000m',
      memory: '4Gi'
    }
  }
};
```

## Load Balancing

### Multi-Region Setup

```typescript
const multiRegionConfig = {
  regions: [
    {
      name: 'us-east-1',
      weight: 40,
      primary: true
    },
    {
      name: 'us-west-2',
      weight: 30
    },
    {
      name: 'eu-west-1',
      weight: 30
    }
  ],
  failover: {
    enabled: true,
    healthCheckInterval: 30
  }
};
```

## Security Hardening

### Production Security Checklist

```typescript
const securityConfig = {
  // Network Security
  network: {
    allowedIPs: ['10.0.0.0/8'],
    requireHTTPS: true,
    tlsVersion: '1.3'
  },
  
  // Authentication
  auth: {
    requireAPIKey: true,
    rotateKeys: true,
    keyRotationDays: 90
  },
  
  // Data Protection
  encryption: {
    atRest: true,
    inTransit: true,
    keyManagement: 'aws-kms'
  },
  
  // Access Control
  rbac: {
    enabled: true,
    roles: ['admin', 'developer', 'viewer']
  }
};
```

## Monitoring Setup

### Metrics Collection

```typescript
const monitoringConfig = {
  metrics: {
    provider: 'datadog',
    interval: 60,
    custom: [
      'agent.executions',
      'agent.errors',
      'agent.latency',
      'tool.calls'
    ]
  },
  
  logging: {
    provider: 'elasticsearch',
    level: 'info',
    retention: 30 // days
  },
  
  tracing: {
    provider: 'jaeger',
    sampleRate: 0.1
  }
};
```

## Health Checks

### Liveness Probe

```typescript
app.get('/health/live', (req, res) => {
  res.json({ status: 'alive' });
});
```

### Readiness Probe

```typescript
app.get('/health/ready', async (req, res) => {
  const checks = await Promise.all([
    checkDatabase(),
    checkRedis(),
    checkAgentEngine()
  ]);
  
  if (checks.every(c => c.healthy)) {
    res.json({ status: 'ready', checks });
  } else {
    res.status(503).json({ status: 'not ready', checks });
  }
});
```

## Disaster Recovery

### Backup Strategy

```typescript
const backupConfig = {
  schedule: '0 2 * * *', // Daily at 2 AM
  retention: {
    daily: 7,
    weekly: 4,
    monthly: 12
  },
  destinations: [
    's3://backups/lightfast',
    'gs://backup-mirror/lightfast'
  ]
};
```

### Failover Plan

```typescript
const failoverConfig = {
  strategy: 'active-passive',
  primary: 'us-east-1',
  secondary: 'us-west-2',
  
  triggers: [
    { type: 'health', threshold: 3 },
    { type: 'latency', threshold: 5000 },
    { type: 'errors', threshold: 0.05 }
  ],
  
  actions: {
    preFailover: ['snapshot-state', 'notify-team'],
    failover: ['switch-dns', 'activate-secondary'],
    postFailover: ['verify-health', 'update-monitoring']
  }
};
```

## Performance Tuning

### Optimization Strategies

```typescript
const performanceConfig = {
  caching: {
    enabled: true,
    provider: 'redis',
    ttl: 3600
  },
  
  connectionPooling: {
    min: 10,
    max: 100,
    idleTimeout: 30000
  },
  
  compression: {
    enabled: true,
    algorithm: 'gzip',
    level: 6
  }
};
```

## Deployment Checklist

- [ ] Environment variables configured
- [ ] Secrets management setup
- [ ] Database migrations run
- [ ] Health checks implemented
- [ ] Monitoring configured
- [ ] Alerts setup
- [ ] Load testing completed
- [ ] Security scan passed
- [ ] Documentation updated
- [ ] Rollback plan ready

## Rollback Procedures

```bash
# Quick rollback
lightfast rollback --version previous

# Specific version rollback
lightfast rollback --version 1.2.3

# Blue-green deployment
lightfast deploy --strategy blue-green --auto-rollback
```

Deployment is where preparation meets production - plan thoroughly, deploy confidently!